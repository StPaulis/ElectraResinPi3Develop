version: '2.1'
services:
  Router:
    build: ./Router
    privileged: true
    network_mode: "host"
    depends_on:
      - RabbitMQ
    labels:
      io.balena.features.supervisor-api: '1'  
  Power:
    build: ./Power
    privileged: true
    network_mode: "host"
    depends_on:
      - RabbitMQ
    labels:
      io.balena.features.supervisor-api: '1'         
  RabbitMQ:
    image: "arm32v7/rabbitmq:3.6-management"
    environment:
      RABBITMQ_DEFAULT_USER: "guest"
      RABBITMQ_DEFAULT_PASS: "guest"
      RABBITMQ_DEFAULT_VHOST: "/"
    ports:
      - "15672:15672"
      - "5672:5672"
    volumes:
      - "./enabled_plugins:/etc/rabbitmq/enabled_plugins"
    labels:
      io.balena.features.supervisor-api: '1'
